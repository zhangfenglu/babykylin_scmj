{
  "version": 3,
  "sources": [
    "unknown"
  ],
  "names": [],
  "mappings": "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",
  "file": "unknown",
  "sourcesContent": [
    "if(window.io == null){\r\n    window.io = require(\"socket-io\");\r\n}\r\n \r\nvar Global = cc.Class({\r\n    extends: cc.Component,\r\n    statics: {\r\n        ip:\"\",\r\n        sio:null,\r\n        isPinging:false,\r\n        fnDisconnect:null,\r\n        handlers:{},\r\n        addHandler:function(event,fn){\r\n            if(this.handlers[event]){\r\n                console.log(\"event:\" + event + \"' handler has been registered.\");\r\n                return;\r\n            }\r\n\r\n            var handler = function(data){\r\n                //console.log(event + \"(\" + typeof(data) + \"):\" + (data? data.toString():\"null\"));\r\n                if(event != \"disconnect\" && typeof(data) == \"string\"){\r\n                    data = JSON.parse(data);\r\n                }\r\n                fn(data);\r\n            };\r\n            \r\n            this.handlers[event] = handler; \r\n            if(this.sio){\r\n                console.log(\"register:function \" + event);\r\n                this.sio.on(event,handler);\r\n            }\r\n        },\r\n        connect:function(fnConnect,fnError) {\r\n            var self = this;\r\n            \r\n            var opts = {\r\n                'reconnection':false,\r\n                'force new connection': true,\r\n                'transports':['websocket', 'polling']\r\n            }\r\n            this.sio = window.io.connect(this.ip,opts);\r\n            this.sio.on('reconnect',function(){\r\n                console.log('reconnection');\r\n            });\r\n            this.sio.on('connect',function(data){\r\n                self.sio.connected = true;\r\n                fnConnect(data);\r\n            });\r\n            \r\n            this.sio.on('disconnect',function(data){\r\n                console.log(\"disconnect\");\r\n                self.sio.connected = false;\r\n                self.close();\r\n            });\r\n            \r\n            this.sio.on('connect_failed',function (){\r\n                console.log('connect_failed');\r\n            });\r\n            \r\n            for(var key in this.handlers){\r\n                var value = this.handlers[key];\r\n                if(typeof(value) == \"function\"){\r\n                    if(key == 'disconnect'){\r\n                        this.fnDisconnect = value;\r\n                    }\r\n                    else{\r\n                        console.log(\"register:function \" + key);\r\n                        this.sio.on(key,value);                        \r\n                    }\r\n                }\r\n            }\r\n            \r\n            this.startHearbeat();\r\n        },\r\n        \r\n        startHearbeat:function(){\r\n            this.sio.on('game_pong',function(){\r\n                console.log('game_pong');\r\n                self.lastRecieveTime = Date.now();\r\n                self.delayMS = self.lastRecieveTime - self.lastSendTime;\r\n                console.log(self.delayMS);\r\n            });\r\n            this.lastRecieveTime = Date.now();\r\n            var self = this;\r\n            console.log(1);\r\n            if(!self.isPinging){\r\n                self.isPinging = true;\r\n                cc.game.on(cc.game.EVENT_HIDE,function(){\r\n                    self.ping();\r\n                });\r\n                setInterval(function(){\r\n                    if(self.sio){\r\n                        self.ping();                \r\n                    }\r\n                }.bind(this),5000);\r\n                setInterval(function(){\r\n                    if(self.sio){\r\n                        if(Date.now() - self.lastRecieveTime > 10000){\r\n                            self.close();\r\n                        }         \r\n                    }\r\n                }.bind(this),500);\r\n            }   \r\n        },\r\n        send:function(event,data){\r\n            if(this.sio.connected){\r\n                if(data != null && (typeof(data) == \"object\")){\r\n                    data = JSON.stringify(data);\r\n                    //console.log(data);              \r\n                }\r\n                this.sio.emit(event,data);                \r\n            }\r\n        },\r\n        \r\n        ping:function(){\r\n            if(this.sio){\r\n                this.lastSendTime = Date.now();\r\n                this.send('game_ping');\r\n            }\r\n        },\r\n        \r\n        close:function(){\r\n            console.log('close');\r\n            this.delayMS = null;\r\n            if(this.sio && this.sio.connected){\r\n                this.sio.connected = false;\r\n                this.sio.disconnect();\r\n            }\r\n            this.sio = null;\r\n            if(this.fnDisconnect){\r\n                this.fnDisconnect();\r\n                this.fnDisconnect = null;\r\n            }\r\n        },\r\n        \r\n        test:function(fnResult){\r\n            var xhr = null;\r\n            var fn = function(ret){\r\n                fnResult(ret.isonline);\r\n                xhr = null;\r\n            }\r\n            \r\n            var arr = this.ip.split(':');\r\n            var data = {\r\n                account:cc.vv.userMgr.account,\r\n                sign:cc.vv.userMgr.sign,\r\n                ip:arr[0],\r\n                port:arr[1],\r\n            }\r\n            xhr = cc.vv.http.sendRequest(\"/is_server_online\",data,fn);\r\n            setTimeout(function(){\r\n                if(xhr){\r\n                    xhr.abort();\r\n                    fnResult(false);                    \r\n                }\r\n            },1500);\r\n            /*\r\n            var opts = {\r\n                'reconnection':false,\r\n                'force new connection': true,\r\n                'transports':['websocket', 'polling']\r\n            }\r\n            var self = this;\r\n            this.testsio = window.io.connect(this.ip,opts);\r\n            this.testsio.on('connect',function(){\r\n                console.log('connect');\r\n                self.testsio.close();\r\n                self.testsio = null;\r\n                fnResult(true);\r\n            });\r\n            this.testsio.on('connect_error',function(){\r\n                console.log('connect_failed');\r\n                self.testsio = null;\r\n                fnResult(false);\r\n            });\r\n            */\r\n        }\r\n    },\r\n});"
  ]
}